# 游戏设计文档 (Game Design Document)

## 1. 核心战斗框架 (Core Combat Framework)
整个战斗分为，计算先攻顺序，计算命中与否，计算命中后伤害数值。

### 1.1 战斗综述
战斗采用 **1v1 回合制**。
*   **胜利条件**: 一方达到“战败条件”（如：机体耐久归零 / 驾驶员气力衰减至强制撤退，暂定四回合），最终以剩余HP血量占比确定胜负。
*   **回合结构**: 先攻方行动 -> 后攻方行动 -> 回合结算。
*   **核心资源**: **优势值 (Advantage)**。它不仅决定战斗走向，还影响下一回合的先手权。

### 1.2 单回合流程
1.  **先手判定阶段**: 确定本回合谁是“先攻方”，谁是“后攻方”。
2.  **先攻方**执行 [攻击] + **后攻方**执行[防御]。
3.  **后攻方**执行 [攻击] + **先攻方**执行[防御]。
4.  **结算阶段**:
    *   计算伤害与状态效果。
    *   **优势值结算**: 计算本回合双方获得的优势值。
    *   **优势积累**: 将本回合优势带入下一回合（含衰减与上限逻辑）。

---

## 2. 先手判定逻辑 (Initiative System)

先手权不再仅仅是敏捷属性的比拼，而是一个分层的动态计算过程。

### 第一层：绝对优先权 (Priority Override)
*   检查双方是否触发“优先先手条件”（例如：机体特殊技能“超频反应”、战场突发事件“偷袭”）。
*   **逻辑**:
    *   若仅一方触发 -> 该方直接先手。
    *   若无触发或双方同时触发 -> 进入第二层判断。

### 第二层：综合优势判定 (Standard Calculation)
当无绝对优先权时，通过计算由三个维度构成的 **判定值 (Score)** 来决定。

#### A. 核心基底 (Base Score)
*   公式: `基底 = (机体性能 * 权重A) + (驾驶员感知 * 权重B)`
*   *设计意图*: 硬件和驾驶员素质是决定性因素，占高权重。

#### B. 局势修正 (Situational Modifiers)
计算两个修正项：
1.  **累积优势 (Previous Advantage)**: 上回合带入的优势值（中等权重）。
2.  **随机事件 (Random Event)**: 战场环境的随机扰动（低权重）。

#### C. 分层判定算法 (The Logic)
计算双方基底差距 `Delta = Abs(基底A - 基底B)`。

*   **情况 1: 势均力敌 (Delta < 阈值)**
    *   *机制*: 降低“随机事件”的权重，极大提高“累积优势”的权重。
    *   *目的*: 此时比拼的是谁在上一回合打得更好。若累积优势也持平，则给予“弱势方”或“上回合后手方”优先权（动态平衡）。

*   **情况 2: 实力悬殊 (Delta >= 阈值)**
    *   *机制*:
        *   **弱势方的反超机会**: 若弱势方的“累积优势”足够高，可以获得额外的 **加成系数** 来抵消基底差距。
        *   **强势方限制**: 强势方的基底优势计算设有 **软上限 (Soft Cap)**，防止因机体性能过强导致无脑连胜，给予弱势方翻盘空间。

---

## 3. 优势系统 (Advantage System)

“优势”是战斗中的核心动态资源。

### 3.1 优势来源 (Acquisition)
优势值由以下四个因素加权汇总：
1.  **机体性能差异** (静态)
2.  **驾驶员感知判定** (静态/动态)
3.  **战场环境随机事件** (随机)
4.  **上回合积累优势** (继承)

### 3.2 动态制衡 (Balancing)
*   **防御奖励**: 弱势方若在本回合成功执行“防御”（如完全格挡伤害），额外获得大量优势值。这是打破强势方压制的关键突破口。
*   **衰减规则**: 优势值在带入下一回合时会进行 **衰减 (Decay)**（例如保留 80%），且设有 **最大累积上限**，防止滚雪球效应失控。

---

## 4. 战斗判定：圆桌理论 (Combat Resolution: Attack Table)

核心逻辑采取 **单一随机数判定 (One-Roll System)**。系统生成一个 0-100 的随机数，按照优先级顺序落在“圆桌”的某个区间内。

### 4.1 优先级与判定区间
优先级由高到低排列（高优先级优先占据圆桌容量，若总和超过 100%，低优先级项被挤出）：

1.  **未命中 (Miss)**: 攻击彻底落空。（默认值为12%，通过攻击方命中加成最低减到0%）
    *   *结果*: 0 伤害。
    *   *优势变动*: 无。
2.  **躲闪 (Dodge)**: 攻击被完全规避。（默认值为22%，通过攻击方精准与防御方躲闪加成的差额计算，最低可为0%）
    *   *结果*: 0 伤害。
    *   *优势变动*: 无。
3.  **招架 (Parry)**: 攻击被武器招架。（默认值为15%，通过攻击方精准与防御方招架加成的差额计算，最高可为50%）
    *   *结果*: 0 伤害。
    *   *优势变动*: **招架方获得大量优势** (如 +2000)。
4.  **格挡 (Block)**: 攻击被盾牌/护甲阻挡。（默认值为20%，通过防御方格挡率加成计算，最高可为80%）
    *   *结果*: 伤害减少 (减伤值 = 格挡值)。
    *   *优势变动*: **格挡方获得少量优势** (如 +1000)。
5.  **暴击 (Crit)**: 命中要害。（默认值为25%，通过攻击方暴击加成，上限100%）
    *   *结果*: 伤害倍率提升 (如 150%)。
    *   *优势变动*: 无 (暴击本身即是奖励)。
6.  **普通命中 (Hit)**: 剩余概率区间。
    *   *结果*: 造成基础 100% 伤害。
    *   *优势变动*: 无。

### 4.2 伤害计算 (Damage Calculation)

当判定为 **命中 (Hit)** 或 **暴击 (Crit)** 时，进入伤害计算流程。

#### A. 基础伤害公式
*   `初始伤害 = 武器伤害 + (机体性能 * 强度系数)`
*   `暴击修正`: 若判定为暴击，初始伤害 x 1.5 

#### B. 护甲减免 (Armor Mitigation)
采用 **非线性减伤公式** (参考 WoW 机制)，确保护甲收益递减但“有效生命值 (EHP)”呈线性增长。

*   **公式**: `减伤百分比 = 护甲值 / (护甲值 + K)`
    *   *K*: 常数系数 (例如设置为 50 或 100，根据游戏数值膨胀程度调整)。
    *   *示例*: 若 K=100，护甲=100 时减伤 50%；护甲=300 时减伤 75%。

#### C. 最终伤害
`最终伤害 = 初始伤害 * (1 - 减伤百分比) - 格挡值(若触发格挡)`

---

### 4.3 熟练度系统 (Proficiency System)

熟练度是角色成长的长期积累，线性影响圆桌概率的“基准值”。

#### A. 武器熟练度 (Weapon Proficiency)
*   影响项: **未命中率 (Miss Rate)**
*   **机制**:
    *   熟练度 = 该武器累计使用次数。
    *   **阈值**: 1000 次。
    *   **惩罚**: 若熟练度 < 1000，未命中率增加（**先慢后快**特性）。
        *   0 次: 30% 未命中 (惩罚上限)。
        *   1000 次: 12% 未命中 (达到基础值，不再随熟练度优化)。
    *   *公式*: `当前未命中率 = 12% + (18% * (1 - (Min(次数, 1000)/1000)^1.5))`
    *   说明: 使用幂函数，前期熟练度提升对未命中率改善较小，后期提升效果加速。

#### B. 机体熟练度 (Mecha Proficiency)
*   影响项: **基础闪避 (Dodge)** & **招架 (Parry)**
*   **机制**:
    *   熟练度 = 该机体累计出战次数。
    *   **阈值**: 4000 次。
    *   **解锁**: 熟练度 < 4000 时，闪避和招架率按对数增长（**先快后慢**特性），初期快速提升，后期收益递减。
        *   0 次: 0% 闪避 / 0% 招架。
        *   4000 次: 22% 闪避 / 15% 招架 (达到完全体性能)。
    *   *公式*: `当前比率 = 基础比率 * (log(Min(次数, 4000) + 1) / log(4000 + 1))`
    *   说明: 使用对数函数，前期少量出战次数即可获得大部分闪避和招架加成，后期提升逐渐放缓。

---

## 5. 战场环境：交战距离 (Combat Range)

为了体现“真实系机器人”的战场感，引入 **动态距离** 机制。战斗不仅仅是立桩输出，而是从远距离索敌到近身格斗的动态过程。

### 5.1 距离变化逻辑 (Dynamic Closing)

#### A. 距离范围（单向逼近）
*   **初始遭遇**: 双方在 **3000m - 7000m** 开始雷达接触。
*   **高速接近**: 双方机体以全速逼近，每回合距离区间整体缩进 **1500m**。
*   **死斗领域**:
    *   下限最低降至 **0m** (贴身格斗)。
    *   上限最低降至 **2000m** (近距狗斗)。
    *   当达到上限 2000m 时，战斗固定在 **0m - 2000m** 范围内进行。

#### B. 距离随机化（每回合具体取值）
*   **机制**: 每回合开始时，在上述距离范围内**随机抽取一个具体距离值**。
*   **目的**: 强制玩家全面发展三类武器，避免专精单一类型。
*   **判定**: 根据随机出的具体距离，判定哪些武器可用/不可用。

**设计意图**:
- T3回合距离范围跨越格斗/射击/狙击三类武器区间
- 同样是T3，可能随机到1200m（格斗回合）或4800m（狙击回合）
- 玩家无法预测，必须携带多种武器以应对所有可能性

### 5.2 武器适性 (Weapon Compatibility)
| 武器类型         | 有效距离          | 惩罚规则              | 战术定位                                                                  |
| :--------------- | :---------------- | :-------------------- | :------------------------------------------------------------------------ |
| **格斗 (Melee)** | **< 2000m**       | **无法使用**          | 光束军刀/热能斧。**0-2000m** 视为机动突击范围，一旦进入即可发动打击。 |
| **射击 (Rifle)** | **1000m - 6000m** | 命中 -30% (过近/过远) | 光束步枪。泛用性强，但在极近距离 (<1000m) 难以锁定高机动目标。            |
| **狙击 (Heavy)** | **> 3000m**       | **无法使用**          | 重炮/导弹。进入 3000m 以内因视角和回旋速度限制，彻底失效。                |


---

---

## 5. 数据结构预览 (Schema Preview)
